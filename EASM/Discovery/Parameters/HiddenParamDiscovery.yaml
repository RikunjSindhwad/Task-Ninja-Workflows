config:
  name: "Hidden Parameters Discovery"
  author: "Rikunj Sindhwad"
  usage: "./TaskNinja -w HiddenParamDiscovery.yaml -v list=<list of URLS>,RESULT=Final Result Path"
  shell: "/bin/bash"
  # stdoutDir: logs
  # stderrDir: logs
vars:
  list: ""
  HIVE: "hive"
  INPUT_DIR: "hive/in"
  OUTPUT_DIR: "hive/out"
  userAgent: "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
  x8: "robensive/x8:latest"
  dockerinput: "/hive/in"
  dockeroutput: "/hive/out"
  RESULT: "" # Modify final list name

tasks:
  - name: Validate Requirements
    silent: true
    parallel: false
    stoponerr: true
    cmds:
      - programs=("docker" "grep" "cp" "sudo" "sort" "jq" "cat")
      - for program in "${programs[@]}"; do command -v "$program" >/dev/null 2>&1 || { echo >&2 "$program is not installed."; exit 1;}; done
  - name: Make Required Directories
    silent: true
    parallel: false
    stoponerr: true
    cmds:
      - rm -rf {{OUTPUT_DIR}} {{INPUT_DIR}}
      - mkdir -p {{OUTPUT_DIR}} {{INPUT_DIR}}
  - name: Get URLS
    silent: false
    parallel: false
    stoponerr: true
    cmds:
      - mkdir -p {{INPUT_DIR}}/URLS
      - cp {{list}} {{INPUT_DIR}}/URLS/list.txt
  - name: Get Wordlists
    silent: true
    parallel: false
    stoponerr: true
    cmds:
      - mkdir -p {{INPUT_DIR}}/Wordlists
      - wget -q https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/burp-parameter-names.txt -O {{INPUT_DIR}}/Wordlists/burp-parameter-names.txt
  - name: Parameter Discovery (GET & POST)
    silent: true
    parallel: false
    stoponerr: false
    type: dynamic
    dynamicFile: "hive/in/URLS/list.txt"
    threads: 8
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/ParamDiscovery
      - md5_value=$(echo -n "{{dynamicFile}}" | md5sum | awk '{print $1}')
      - docker container run --rm -v  $(pwd)/hive:/hive {{x8}} --output-format json --method GET POST -H '{{userAgent}}' --url '{{dynamicFile}}' --output "{{dockeroutput}}/ParamDiscovery/Get-$md5_value.json"
  - name: Result
    silent: false
    parallel: false
    cmds:
      - echo '"URL". "Method", "Status", "Parameter", "Location"' | tee {{RESULT}}
      - cat {{OUTPUT_DIR}}/ParamDiscovery/* | jq -r '.[] | select(.found_params | length > 0) | [.url, .method, .status, (.found_params | map(.name + ":" + (.value // "null")) | join("\n")), .injection_place] | @csv' | tee -a {{RESULT}}
