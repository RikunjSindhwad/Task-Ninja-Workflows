config:
  name: "Discovery Passive Subdomains"
  author: "Rikunj Sindhwad"
  usage: "Task-Ninja -w passiveSubdomains -v list=tld.txt,RESULT=PassiveSubdomains-merged.txt"
  # stdoutDir: log
  # stderrDir: log
vars:
  tld_list: "" # Target Domains (tesla.com || abc.come etc)
  HIVE: "hive"
  INPUT_DIR: "hive/in"
  OUTPUT_DIR: "hive/out"
  dockerinput: "/hive/in"
  dockeroutput: "/hive/out"
  assetfinder: "robensive/assetfinder:latest" # done
  jidc-subdomains: "robensive/jidc-subdomains:latest" # done
  subdomain.center: "robensive/subdomain.center:latest" # done
  # githubsubdomains: "robensive/github-subdomains:latest"  # You Can enable if you have AuthToken (wait for upgrade for sample)
  findomain: "robensive/findomain"
  vita: "robensive/vita:latest"
  subfinder: "projectdiscovery/subfinder:latest" 
  # chaos-client: "projectdiscovery/chaos-client"  # You Can enable if you have key (wait for upgrade for sample)
  RESULT: "" # Modify final list name or specify with -v

tasks:
  - name: Create Main Directories
    silent: true
    parallel: false
    cmds:
      - rm -rf {{OUTPUT_DIR}} {{INPUT_DIR}}
      - mkdir -p {{OUTPUT_DIR}} {{INPUT_DIR}}
  - name: JIDC Subdomains
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p  {{OUTPUT_DIR}}/JIDC-Subdomains
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{jidc-subdomains}} {{dynamicFile}} {{dockeroutput}}/JIDC-Subdomains/{{dynamicFile}}-results.txt
  - name: Subdomain Center Subdomains
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/SubdomainCenter
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{subdomain.center}} {{dynamicFile}} {{dockeroutput}}/SubdomainCenter/{{dynamicFile}}-results.txt
  - name: Wait-Job1
    silent: true
    parallel: false
    required:
      - JIDC Subdomains
      - Subdomain Center Subdomains
    cmds:
      - echo waiting for parallel jobs to complete
  - name: AssetFinder
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/AssetFinder
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{assetfinder}} --subs-only {{dynamicFile}} {{dockeroutput}}/AssetFinder/{{dynamicFile}}-results.txt
  - name: Findomain
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/Findomain
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{findomain}} -t {{dynamicFile}} --unique-output "{{dockeroutput}}/Findomain/{{dynamicFile}}-results.txt"
  - name: Wait-Job2
    silent: true
    parallel: false
    required:
      - AssetFinder
      - Findomain
    cmds:
      - echo waiting for parallel jobs to complete
  - name: VITA Subdomains
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/VITA
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{vita}} "-d {{dynamicFile}} --subs-only > {{dockeroutput}}/VITA/{{dynamicFile}}-results.txt"
  - name: Subfinder
    silent: true
    parallel: true
    type: dynamic
    dynamicFile: test/tld.txt
    threads: 3
    cmds:
      - mkdir -p {{OUTPUT_DIR}}/Subfinder
      - sudo docker container run --rm -v $(pwd)/hive:/hive {{subfinder}} -silent -d {{dynamicFile}}  -o  "{{dockeroutput}}/Subfinder/{{dynamicFile}}-results.txt"
  - name: Merge All
    silent: true
    parallel: false
    required: 
      - JIDC Subdomains
      - Subdomain Center Subdomains
      - AssetFinder
      - Findomain
      - VITA Subdomains
      - Subfinder
    cmds:
      - find {{OUTPUT_DIR}} -type f -name "*results.txt" -exec cat {} + | tee {{RESULT}}
  - name: Get Result
    silent: false
    parallel: false
    required: 
      - Merge Both
    cmds:
      - echo Check-Result:$(ls {{RESULT}})
      - echo IdentifiedLines:$(cat {{RESULT}} | wc -l)
